# Visual StudioとOpenCVを使ってみよう

では，早速Visual Studio 2013を使ってみましょう．

Visual Studio 2013の画面構成は以下のようになります．

新しいプログラムを作る際は，

Visual StudioでOpenCVを使うためには，OpenCVのソースコードがあるディレクトリの場所を設定します．




以下に画像を表示するだけの単純なプログラムを掲載しています．

```c++
#include <opencv2/opencv.hpp>
#include <opencv2/opencv_lib.hpp>
#include <opencv2/highgui/highgui.hpp>

using namespace cv;

int main()
{
  Mat src_img;
  src_img = imread("ファイルパス", 1);
  // 画像が読み込まれなかったらプログラム終了
  if(src_img.empty()) return -1;

  // 結果画像表示
  namedWindow("src_img", CV_WINDOW_AUTOSIZE|CV_WINDOW_FREERATIO);
  imshow("Image", src_img);
  waitKey(0);
}
```

コードの説明をします．

まず，OpenCVが提供する関数(プログラム)は，CV~~といった名前がつけられています(cvNamedWindow,cvShowImageなど)．

これらの関数を利用するために，opencv.hpp,opencv_lib.hpp，highgui.hppというヘッダーファイルを読み込ませる必要があります．所謂`「今からOpenCVの関数を使いますよー」`という合図だと思ってもらえれば良いです．

```c++
    Mat src_img;
```

`Mat`クラスはMatrix(行列)の略で，2次元の行列を用意します．

OpenCVでは，画像を2次元の行列として扱います．

![](/img/RGB.png)

今回扱うのはカラー画像ですから，1枚の画像につき3つの行列を作ることになります．

コンピュータで扱うことの出来るディジタル画像は，基本的に赤・緑・青の3つの色の強さの度合いの組み合わせで表現されています．

ディジタル画像についての色の表現方法や，詳しい表色系の説明については，この講義では詳しく話をする時間がないので省略させて頂きます．とりあえず，この時点では`画像は行列によって表現される`と覚えておいて下さい．

```c++
    src_img = imread("ファイルパス", 1);
```

`imread`という関数は，ファイルから画像を読み込む為の関数です．引数はそれぞれ，ファイルの存在する場所(パス)，画像の読み込みモードです．画像の読み込みモードは1ならばカラー，0ならばグレースケールに変換します．

なお，グレースケール画像として読み込む場合は，白黒成分を表すだけで良いですから，行列は1つだけ用意されます．

```c++
　// 画像が読み込まれなかったらプログラム終了
  if(src_img.empty()) return -1;
```

画像が上手く読み込めなかった場合は，プログラムが止まるようにします．このような処理を`例外処理`といいます．このプログラムは，指定した画像を読み込めなければ，その後の処理を行うことが出来ません．指定した画像がない場合，プログラムは正しく動くことが出来ないのです．そこでプログラムが不正に終了したり，また暴走する事を防ぐために例外処理のコードを書いておくのです．

```c++
　// 結果画像表示
  namedWindow("Image", CV_WINDOW_AUTOSIZE|CV_WINDOW_FREERATIO);
  imshow("Image", src_img);
  waitKey(0);
```

`namedWindow()`は読み込んだ画像を表示するためのウィンドウを作る関数です．

ここでは，src_imgという名前のウィンドウを，カメラのキャプチャサイズに合わせてウィンドウを作れというコードを書いています．

ウィンドウサイズは自分で自由に指定することも出来ますが，特別な理由が無い限りはオートサイズにしておく方が良いでしょう．

なお，ウィンドウの名前には日本語も使用出来ます．

`imshow()`はnamedWindow()で作ったウィンドウに，読み込んだ画像を入れて画面に表示する関数です．imshow()はnamedWindow()とセットで使うということを覚えておきましょう．

先のnamedWindow()でImageという名前のウィンドウを作ったので，Imageウィンドウにsrc_img(つまり，読み込んだ画像)を入力して表示させるという命令をしています．

`waitKey()`は指定したキーのキー入力があるまで次のコードを実行せずに待機する関数です．引数に0を指定した場合は，キーボードのいずれかのキーを押すまで待機する，という意味になります．